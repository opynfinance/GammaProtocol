<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: UmlClassDiagram Pages: 1 -->
<svg width="1423pt" height="1380pt"
 viewBox="0.00 0.00 1422.96 1379.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1375.6)">
<title>UmlClassDiagram</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1375.6 1418.9612,-1375.6 1418.9612,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<polygon fill="#f2f2f2" stroke="#000000" points="0,-406.3 0,-1371.1 1414.9612,-1371.1 1414.9612,-406.3 0,-406.3"/>
<text text-anchor="middle" x="707.4806" y="-1354.5" font-family="Times,serif" font-size="14.00" fill="#000000">MarginCalculator</text>
<polyline fill="none" stroke="#000000" points="0,-1346.3 1414.9612,-1346.3 "/>
<text text-anchor="start" x="8" y="-1329.7" font-family="Times,serif" font-size="14.00" fill="#000000">Internal:</text>
<text text-anchor="start" x="8" y="-1312.9" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;SCALING_FACTOR: uint256</text>
<text text-anchor="start" x="8" y="-1296.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;BASE: uint256</text>
<text text-anchor="start" x="8" y="-1279.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;oracleDeviation: uint256</text>
<text text-anchor="start" x="8" y="-1262.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;ZERO: FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-1245.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;dust: mapping(address=&gt;uint256)</text>
<text text-anchor="start" x="8" y="-1228.9" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;timesToExpiryForProduct: mapping(bytes32=&gt;uint256[])</text>
<text text-anchor="start" x="8" y="-1212.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;maxPriceAtTimeToExpiry: mapping(bytes32=&gt;mapping(uint256=&gt;uint256))</text>
<text text-anchor="start" x="8" y="-1195.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;spotShock: mapping(bytes32=&gt;uint256)</text>
<text text-anchor="start" x="8" y="-1178.5" font-family="Times,serif" font-size="14.00" fill="#000000">Public:</text>
<text text-anchor="start" x="8" y="-1161.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;AUCTION_TIME: uint256</text>
<text text-anchor="start" x="8" y="-1144.9" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;oracle: OracleInterface</text>
<polyline fill="none" stroke="#000000" points="0,-1136.7 1414.9612,-1136.7 "/>
<text text-anchor="start" x="8" y="-1120.1" font-family="Times,serif" font-size="14.00" fill="#000000">Internal:</text>
<text text-anchor="start" x="8" y="-1103.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getExpiredCashValue(_underlying: address, _strike: address, _expiryTimestamp: uint256, _strikePrice: uint256, _isPut: bool): FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-1086.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getMarginRequired(_vault: MarginVault.Vault, _vaultDetails: VaultDetails): (FPI.FixedPointInt, FPI.FixedPointInt)</text>
<text text-anchor="start" x="8" y="-1069.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getNakedMarginRequired(_productHash: bytes32, _shortAmount: FPI.FixedPointInt, _underlyingPrice: FPI.FixedPointInt, _strikePrice: FPI.FixedPointInt, _shortExpiryTimestamp: uint256, _isPut: bool): FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-1052.9" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_findUpperBoundValue(_productHash: bytes32, _expiryTimestamp: uint256): FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-1036.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getPutSpreadMarginRequired(_shortAmount: FPI.FixedPointInt, _longAmount: FPI.FixedPointInt, _shortStrike: FPI.FixedPointInt, _longStrike: FPI.FixedPointInt): FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-1019.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getCallSpreadMarginRequired(_shortAmount: FPI.FixedPointInt, _longAmount: FPI.FixedPointInt, _shortStrike: FPI.FixedPointInt, _longStrike: FPI.FixedPointInt): FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-1002.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_convertAmountOnLivePrice(_amount: FPI.FixedPointInt, _assetA: address, _assetB: address): FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-985.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_convertAmountOnExpiryPrice(_amount: FPI.FixedPointInt, _assetA: address, _assetB: address, _expiry: uint256): FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-968.9" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getDebtPrice(_vaultCollateral: FPI.FixedPointInt, _vaultDebt: FPI.FixedPointInt, _cashValue: FPI.FixedPointInt, _spotPrice: FPI.FixedPointInt, _auctionStartingTime: uint256, _collateralDecimals: uint256, _isPut: bool): uint256</text>
<text text-anchor="start" x="8" y="-952.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getVaultDetails(_vault: MarginVault.Vault, _vaultType: uint256): VaultDetails</text>
<text text-anchor="start" x="8" y="-935.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getExpiredSpreadCashValue(_shortAmount: FPI.FixedPointInt, _longAmount: FPI.FixedPointInt, _shortCashValue: FPI.FixedPointInt, _longCashValue: FPI.FixedPointInt): FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-918.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_isNotEmpty(_assets: address[]): bool</text>
<text text-anchor="start" x="8" y="-901.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_checkIsValidVault(_vault: MarginVault.Vault, _vaultDetails: VaultDetails)</text>
<text text-anchor="start" x="8" y="-884.9" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_isMarginableLong(_vault: MarginVault.Vault, _vaultDetails: VaultDetails): bool</text>
<text text-anchor="start" x="8" y="-868.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_isMarginableCollateral(_vault: MarginVault.Vault, _vaultDetails: VaultDetails): bool</text>
<text text-anchor="start" x="8" y="-851.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getProductHash(_underlying: address, _strike: address, _collateral: address, _isPut: bool): bytes32</text>
<text text-anchor="start" x="8" y="-834.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getCashValue(_strikePrice: FPI.FixedPointInt, _underlyingPrice: FPI.FixedPointInt, _isPut: bool): FPI.FixedPointInt</text>
<text text-anchor="start" x="8" y="-817.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;_getOtokenDetails(_otoken: address): (address, address, address, uint256, uint256, bool)</text>
<text text-anchor="start" x="8" y="-800.9" font-family="Times,serif" font-size="14.00" fill="#000000">External:</text>
<text text-anchor="start" x="8" y="-784.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setCollateralDust(_collateral: address, _dust: uint256)</text>
<text text-anchor="start" x="8" y="-767.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setUpperBoundValues(_underlying: address, _strike: address, _collateral: address, _isPut: bool, _timesToExpiry: uint256[], _values: uint256[])</text>
<text text-anchor="start" x="8" y="-750.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;updateUpperBoundValue(_underlying: address, _strike: address, _collateral: address, _isPut: bool, _timeToExpiry: uint256, _value: uint256)</text>
<text text-anchor="start" x="8" y="-733.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setSpotShock(_underlying: address, _strike: address, _collateral: address, _isPut: bool, _shockValue: uint256)</text>
<text text-anchor="start" x="8" y="-716.9" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setOracleDeviation(_deviation: uint256)</text>
<text text-anchor="start" x="8" y="-700.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;getCollateralDust(_collateral: address): uint256</text>
<text text-anchor="start" x="8" y="-683.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;getTimesToExpiry(_underlying: address, _strike: address, _collateral: address, _isPut: bool): uint256[]</text>
<text text-anchor="start" x="8" y="-666.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;getMaxPrice(_underlying: address, _strike: address, _collateral: address, _isPut: bool, _timeToExpiry: uint256): uint256</text>
<text text-anchor="start" x="8" y="-649.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;getSpotShock(_underlying: address, _strike: address, _collateral: address, _isPut: bool): uint256</text>
<text text-anchor="start" x="8" y="-632.9" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;getOracleDeviation(): uint256</text>
<text text-anchor="start" x="8" y="-616.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;getNakedMarginRequired(_underlying: address, _strike: address, _collateral: address, _shortAmount: uint256, _strikePrice: uint256, _underlyingPrice: uint256, _shortExpiryTimestamp: uint256, _collateralDecimals: uint256, _isPut: bool): uint256</text>
<text text-anchor="start" x="8" y="-599.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;getExpiredPayoutRate(_otoken: address): uint256</text>
<text text-anchor="start" x="8" y="-582.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;isLiquidatable(_vault: MarginVault.Vault, _vaultType: uint256, _vaultLatestUpdate: uint256, _roundId: uint256): (bool, uint256, uint256)</text>
<text text-anchor="start" x="8" y="-565.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;getMarginRequired(_vault: MarginVault.Vault, _vaultType: uint256): (FPI.FixedPointInt, FPI.FixedPointInt)</text>
<text text-anchor="start" x="8" y="-548.9" font-family="Times,serif" font-size="14.00" fill="#000000">Public:</text>
<text text-anchor="start" x="8" y="-532.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&lt;&lt;event&gt;&gt; CollateralDustUpdated(collateral: address, dust: uint256)</text>
<text text-anchor="start" x="8" y="-515.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&lt;&lt;event&gt;&gt; TimeToExpiryAdded(productHash: bytes32, timeToExpiry: uint256)</text>
<text text-anchor="start" x="8" y="-498.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&lt;&lt;event&gt;&gt; MaxPriceAdded(productHash: bytes32, timeToExpiry: uint256, value: uint256)</text>
<text text-anchor="start" x="8" y="-481.7" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&lt;&lt;event&gt;&gt; MaxPriceUpdated(productHash: bytes32, timeToExpiry: uint256, oldValue: uint256, newValue: uint256)</text>
<text text-anchor="start" x="8" y="-464.9" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&lt;&lt;event&gt;&gt; SpotShockUpdated(product: bytes32, spotShock: uint256)</text>
<text text-anchor="start" x="8" y="-448.1" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&lt;&lt;event&gt;&gt; OracleDeviationUpdated(oracleDeviation: uint256)</text>
<text text-anchor="start" x="8" y="-431.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;constructor(_oracle: address)</text>
<text text-anchor="start" x="8" y="-414.5" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;getExcessCollateral(_vault: MarginVault.Vault, _vaultType: uint256): (uint256, bool)</text>
</g>
<!-- 0struct0 -->
<g id="node2" class="node">
<title>0struct0</title>
<polygon fill="#f2f2f2" stroke="#000000" points="365.3617,-.5 365.3617,-369.3 567.5995,-369.3 567.5995,-.5 365.3617,-.5"/>
<text text-anchor="middle" x="466.4806" y="-352.7" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;&lt;struct&gt;&gt;</text>
<text text-anchor="middle" x="466.4806" y="-335.9" font-family="Times,serif" font-size="14.00" fill="#000000">VaultDetails</text>
<polyline fill="none" stroke="#000000" points="365.3617,-327.7 567.5995,-327.7 "/>
<text text-anchor="start" x="373.3617" y="-311.1" font-family="Times,serif" font-size="14.00" fill="#000000">shortUnderlyingAsset: address</text>
<text text-anchor="start" x="373.3617" y="-294.3" font-family="Times,serif" font-size="14.00" fill="#000000">shortStrikeAsset: address</text>
<text text-anchor="start" x="373.3617" y="-277.5" font-family="Times,serif" font-size="14.00" fill="#000000">shortCollateralAsset: address</text>
<text text-anchor="start" x="373.3617" y="-260.7" font-family="Times,serif" font-size="14.00" fill="#000000">longUnderlyingAsset: address</text>
<text text-anchor="start" x="373.3617" y="-243.9" font-family="Times,serif" font-size="14.00" fill="#000000">longStrikeAsset: address</text>
<text text-anchor="start" x="373.3617" y="-227.1" font-family="Times,serif" font-size="14.00" fill="#000000">longCollateralAsset: address</text>
<text text-anchor="start" x="373.3617" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#000000">shortStrikePrice: uint256</text>
<text text-anchor="start" x="373.3617" y="-193.5" font-family="Times,serif" font-size="14.00" fill="#000000">shortExpiryTimestamp: uint256</text>
<text text-anchor="start" x="373.3617" y="-176.7" font-family="Times,serif" font-size="14.00" fill="#000000">shortCollateralDecimals: uint256</text>
<text text-anchor="start" x="373.3617" y="-159.9" font-family="Times,serif" font-size="14.00" fill="#000000">longStrikePrice: uint256</text>
<text text-anchor="start" x="373.3617" y="-143.1" font-family="Times,serif" font-size="14.00" fill="#000000">longExpiryTimestamp: uint256</text>
<text text-anchor="start" x="373.3617" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#000000">longCollateralDecimals: uint256</text>
<text text-anchor="start" x="373.3617" y="-109.5" font-family="Times,serif" font-size="14.00" fill="#000000">collateralDecimals: uint256</text>
<text text-anchor="start" x="373.3617" y="-92.7" font-family="Times,serif" font-size="14.00" fill="#000000">vaultType: uint256</text>
<text text-anchor="start" x="373.3617" y="-75.9" font-family="Times,serif" font-size="14.00" fill="#000000">isShortPut: bool</text>
<text text-anchor="start" x="373.3617" y="-59.1" font-family="Times,serif" font-size="14.00" fill="#000000">isLongPut: bool</text>
<text text-anchor="start" x="373.3617" y="-42.3" font-family="Times,serif" font-size="14.00" fill="#000000">hasLong: bool</text>
<text text-anchor="start" x="373.3617" y="-25.5" font-family="Times,serif" font-size="14.00" fill="#000000">hasShort: bool</text>
<text text-anchor="start" x="373.3617" y="-8.7" font-family="Times,serif" font-size="14.00" fill="#000000">hasCollateral: bool</text>
</g>
<!-- 0struct0&#45;&gt;0 -->
<g id="edge1" class="edge">
<title>0struct0&#45;&gt;0</title>
<path fill="none" stroke="#000000" d="M529.6431,-369.3554C532.4795,-377.6386 535.3711,-386.0832 538.3092,-394.6633"/>
<polygon fill="#000000" stroke="#000000" points="538.31,-394.6658 544.038,-399.0463 542.1976,-406.0186 536.4695,-401.6381 538.31,-394.6658"/>
</g>
<!-- 0struct1 -->
<g id="node3" class="node">
<title>0struct1</title>
<polygon fill="#f2f2f2" stroke="#000000" points="585.1601,-134.9 585.1601,-234.9 829.8011,-234.9 829.8011,-134.9 585.1601,-134.9"/>
<text text-anchor="middle" x="707.4806" y="-218.3" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;&lt;struct&gt;&gt;</text>
<text text-anchor="middle" x="707.4806" y="-201.5" font-family="Times,serif" font-size="14.00" fill="#000000">ShortScaledDetails</text>
<polyline fill="none" stroke="#000000" points="585.1601,-193.3 829.8011,-193.3 "/>
<text text-anchor="start" x="593.1601" y="-176.7" font-family="Times,serif" font-size="14.00" fill="#000000">shortAmount: FPI.FixedPointInt</text>
<text text-anchor="start" x="593.1601" y="-159.9" font-family="Times,serif" font-size="14.00" fill="#000000">shortStrike: FPI.FixedPointInt</text>
<text text-anchor="start" x="593.1601" y="-143.1" font-family="Times,serif" font-size="14.00" fill="#000000">shortUnderlyingPrice: FPI.FixedPointInt</text>
</g>
<!-- 0struct1&#45;&gt;0 -->
<g id="edge2" class="edge">
<title>0struct1&#45;&gt;0</title>
<path fill="none" stroke="#000000" d="M707.4806,-234.9513C707.4806,-273.0151 707.4806,-329.6941 707.4806,-394.0417"/>
<polygon fill="#000000" stroke="#000000" points="707.4807,-394.1433 711.4806,-400.1433 707.4806,-406.1433 703.4806,-400.1432 707.4807,-394.1433"/>
</g>
<!-- 0struct2 -->
<g id="node4" class="node">
<title>0struct2</title>
<polygon fill="#f2f2f2" stroke="#000000" points="847.3112,-118.1 847.3112,-251.7 1045.65,-251.7 1045.65,-118.1 847.3112,-118.1"/>
<text text-anchor="middle" x="946.4806" y="-235.1" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;&lt;struct&gt;&gt;</text>
<text text-anchor="middle" x="946.4806" y="-218.3" font-family="Times,serif" font-size="14.00" fill="#000000">OtokenDetails</text>
<polyline fill="none" stroke="#000000" points="847.3112,-210.1 1045.65,-210.1 "/>
<text text-anchor="start" x="855.3112" y="-193.5" font-family="Times,serif" font-size="14.00" fill="#000000">otokenUnderlyingAsset: address</text>
<text text-anchor="start" x="855.3112" y="-176.7" font-family="Times,serif" font-size="14.00" fill="#000000">otokenCollateralAsset: address</text>
<text text-anchor="start" x="855.3112" y="-159.9" font-family="Times,serif" font-size="14.00" fill="#000000">otokenStrikeAsset: address</text>
<text text-anchor="start" x="855.3112" y="-143.1" font-family="Times,serif" font-size="14.00" fill="#000000">otokenExpiry: uint256</text>
<text text-anchor="start" x="855.3112" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#000000">isPut: bool</text>
</g>
<!-- 0struct2&#45;&gt;0 -->
<g id="edge3" class="edge">
<title>0struct2&#45;&gt;0</title>
<path fill="none" stroke="#000000" d="M923.7806,-251.7463C911.1627,-288.9032 894.2063,-338.8357 875.3112,-394.4775"/>
<polygon fill="#000000" stroke="#000000" points="875.2378,-394.6938 877.096,-401.6614 871.3791,-406.0566 869.5209,-399.089 875.2378,-394.6938"/>
</g>
</g>
</svg>
